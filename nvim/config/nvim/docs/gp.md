## 使い方

### 1. **単一ファイル選択** (`<C-g>f`)
1. Ctrl+g → f を押す
2. Telescopeでファイルを検索・選択
3. Enterで確定 → 自動的にチャットが開始される

### 2. **複数ファイル選択** (`<C-g>F`)
1. Ctrl+g → Shift+F を押す
2. Telescopeでファイルを表示
3. Tabキーで複数ファイルを選択（選択したファイルはハイライトされる）
4. Shift+Tabで選択解除
5. Enterで確定 → 全ファイルがコンテキストとして送信される

### 3. **Grep検索から選択** (`<C-g>g`)
1. Ctrl+g → g を押す
2. 検索キーワードを入力（例: "function", "TODO", "エラー"）
3. Telescopeでgrep結果が表示される
4. 該当箇所を選択してEnter
5. 選択した行を含むファイル全体がコンテキストとして送信される

### 4. **開いているバッファから選択** (`<C-g>b`)
1. Ctrl+g → b を押す
2. 現在開いているバッファ一覧が表示される
3. 送信したいバッファを選択してEnter
4. バッファの内容全体がコンテキストとして送信される

### 5. **プロジェクトファイル一括選択** (`<C-g>p`)
1. Ctrl+g → p を押す
2. プロジェクト内の主要ファイル（*.lua, *.py, README.mdなど）が表示される
3. Tabで複数ファイルを選択
4. Enterで確定 → 全ファイルがまとめて送信される

### 6. **ビジュアル選択範囲を送信** (`<C-g>c` in visual mode)
1. ビジュアルモード（v, V, Ctrl+v）で範囲を選択
2. Ctrl+g → c を押す
3. 選択範囲だけがコンテキストとして送信される

## 実用例

### 例1: バグ修正の相談
1. <C-g>f でエラーが出ているファイルを選択
2. チャットで「このコードのエラーを修正してください」と入力

### 例2: 複数ファイルのリファクタリング
1. <C-g>F で関連する複数ファイルを選択（Tabで選択）
2. 「これらのファイルをリファクタリングして、コードの重複を減らしてください」

### 例3: TODOコメントの確認
1. <C-g>g で "TODO" を検索
2. 該当箇所を選択
3. 「このTODOを実装する方法を教えてください」

### 例4: プロジェクト全体の説明
1. <C-g>p でプロジェクトの主要ファイルを選択
2. 「このプロジェクトの構造と主な機能を説明してください」

### 例5: 開いているファイルの比較
1. 複数のファイルを開く
2. <C-g>b でバッファ一覧から選択
3. 「これらのファイルの違いを説明してください」

## キーマップ一覧

| キー | モード | 機能 |
|------|--------|------|
| `<C-g>c` | n, i | 新しいチャット開始 |
| `<C-g>c` | v | 選択範囲で新しいチャット |
| `<C-g>t` | n, i | チャットトグル |
| `<C-g>a` | n | エージェント選択 |
| `<C-g>m` | n | コミットメッセージ生成 |
| `<C-g>f` | n | 単一ファイル選択 |
| `<C-g>F` | n | 複数ファイル選択 |
| `<C-g>g` | n | Grep検索から選択 |
| `<C-g>b` | n | バッファから選択 |
| `<C-g>p` | n | プロジェクトファイル選択 |
| `<C-g>a` | v | 選択範囲をチャットに追加 |

## Telescopeの操作

### ファイル選択時
- `j/k` または `↓/↑`: カーソル移動
- `Ctrl+n/p`: 次/前の項目
- `Enter`: 選択して確定
- `Esc`: キャンセル
- `/`: 検索モード

### 複数選択時（`<C-g>F`, `<C-g>p`）
- `Tab`: 現在の項目を選択/解除
- `Shift+Tab`: 選択解除しながら上に移動
- 選択されたファイルは異なる色でハイライト
- `Enter`: 選択したすべてのファイルを確定

## トラブルシューティング

### ファイルが大きすぎる場合
100KB以上のファイルを選択すると確認ダイアログが表示されます。
大きなファイルはトークン制限に注意してください。

### Telescopeが見つからない場合
```lua
-- lazy.nvimの設定で依存関係を追加
dependencies = {
    "nvim-telescope/telescope.nvim",
    "nvim-lua/plenary.nvim",  -- Telescopeの依存
}
```

### プロジェクトファイルが見つからない場合
```lua
-- hooks.TelescopeProject の patterns を編集
local patterns = {
    "*.lua",
    "*.py",
    -- 自分のプロジェクトに合わせて追加
    "*.java",
    "*.cpp",
}
```

## カスタマイズ例

### 特定のディレクトリのみ検索
```lua
TelescopeFile = function(gp, params)
    require('telescope.builtin').find_files({
        prompt_title = "GPT: ファイルを選択",
        cwd = "~/projects/myapp/src",  -- 検索ディレクトリを指定
        -- ...
    })
end,
```

### ファイルサイズ制限を変更
```lua
-- 100000 を 50000 (50KB) に変更
if file_size > 50000 then
    -- 警告表示
end
```
